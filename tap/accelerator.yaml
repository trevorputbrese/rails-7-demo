accelerator:
  displayName: Immigration Messages App Accelerator
  description: Accelerator for CIS Immigration Messages App
  iconUrl: https://www.ruby-lang.org/images/header-ruby-logo.png
  tags:
    - Ruby
    - Rails
    - Immigration
  
  # Place this after the 'tags' section from the previous step
  options:
    - name: Customize your workload yaml 1:
      inputType: text
      defaultValue: "redis-claim-1"
      label: Redis Service Claim Name:
      required: true
    - name: Customize your workload yaml 2:
      inputType: text
      defaultValue: "postgres-claim-1"
      label: Postgres Service Claim Name:
      required: true
  imports:
    - name: tap-workload

engine:
  let:
    - name: backendServiceResourceName
      expression: '#backendService.toLowerCase()'
  chain:
    - applyTo: [ "nginx.conf", "package.json" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: "http://backend"
              with: "'http://' + #backendServiceResourceName"

    - applyTo: [ "README.md", "public/*.html", "public/*.json", "catalog/catalog-info.yaml", "config/workload.yaml" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: "react-frontend"
              with: "#artifactId"

    - merge:
      - type: InvokeFragment
        reference: tap-workload
      - include: [ "**" ]
      onConflict: UseFirst

    - include: [ "**" ]
      exclude: [ "tekton/**" ]
